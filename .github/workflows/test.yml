name: Test Application

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        python -m spacy download en_core_web_sm
        
    - name: Download NLTK data
      run: |
        python -c "import nltk; resources=['punkt','punkt_tab','wordnet','averaged_perceptron_tagger']; [nltk.download(r, quiet=True) for r in resources]"
        
    - name: Test imports
      run: |
        python -c "import streamlit; import spacy; import nltk; print('✅ All imports successful')"
        
    - name: Test transformer module
      run: |
        python -c "from transformer.app import AcademicTextHumanizer, load_spacy_model, download_nltk_resources; print('✅ Transformer module works')"
        
    - name: Basic functionality test
      run: |
        python -c "
        from transformer.app import AcademicTextHumanizer
        humanizer = AcademicTextHumanizer(seed=42)
        result = humanizer.humanize_text('I dont like this.')
        assert 'not' in result or 'do not' in result, 'Contraction expansion failed'
        print('✅ Basic transformation works')
        print(f'Input: I dont like this.')
        print(f'Output: {result}')
        "

